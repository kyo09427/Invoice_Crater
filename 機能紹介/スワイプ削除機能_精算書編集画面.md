# ã‚¹ãƒ¯ã‚¤ãƒ—å‰Šé™¤æ©Ÿèƒ½ - å®Œå…¨å®Ÿè£…ã‚¬ã‚¤ãƒ‰

## ğŸ“± æ©Ÿèƒ½æ¦‚è¦

ç²¾ç®—æ›¸ã‚¢ãƒ—ãƒªã®æ˜ç´°ç·¨é›†ç”»é¢ã§ã€**å·¦ã«ã‚¹ãƒ¯ã‚¤ãƒ—**ã™ã‚‹ã“ã¨ã§æ˜ç´°ã‚’å‰Šé™¤ã§ãã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

### ä¸»ãªç‰¹å¾´

âœ… **ç›´æ„Ÿçš„ãªæ“ä½œ**: å·¦ã‚¹ãƒ¯ã‚¤ãƒ—ã§å‰Šé™¤ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ  
âœ… **è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**: èµ¤ã„èƒŒæ™¯ã¨å‰Šé™¤ã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤º  
âœ… **ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°**: èª¤æ“ä½œé˜²æ­¢ã®ãŸã‚ã®å‰Šé™¤ç¢ºèª  
âœ… **å…ƒã«æˆ»ã™æ©Ÿèƒ½**: SnackBarã‹ã‚‰ã®å–ã‚Šæ¶ˆã—ï¼ˆå°†æ¥å®Ÿè£…äºˆå®šï¼‰  
âœ… **ã‚¹ãƒ ãƒ¼ã‚ºãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**: Material Designã«æº–æ‹ ã—ãŸå‹•ã

## ğŸ”§ å®Ÿè£…ã®è©³ç´°

### 1. Dismissibleã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®åŸºæœ¬æ§‹é€ 

```dart
Dismissible(
  // ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ï¼ˆå¿…é ˆï¼‰
  key: Key(item.id),
  
  // ã‚¹ãƒ¯ã‚¤ãƒ—æ–¹å‘ï¼ˆå³ã‹ã‚‰å·¦ã¸ï¼‰
  direction: DismissDirection.endToStart,
  
  // å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
  confirmDismiss: (direction) => _confirmDismiss(context, direction, item),
  
  // å‰Šé™¤å®Ÿè¡Œæ™‚ã®å‡¦ç†
  onDismissed: (direction) => _onDismissed(direction, item),
  
  // ã‚¹ãƒ¯ã‚¤ãƒ—ä¸­ã«è¡¨ç¤ºã•ã‚Œã‚‹èƒŒæ™¯
  background: Container(
    color: Colors.red,
    alignment: Alignment.centerRight,
    padding: const EdgeInsets.only(right: 20),
    child: const Column(
      mainAxisAlignment: MainAxisAlignment.center,
      children: [
        Icon(Icons.delete_outline, color: Colors.white, size: 32),
        SizedBox(height: 4),
        Text('å‰Šé™¤', style: TextStyle(color: Colors.white)),
      ],
    ),
  ),
  
  // å®Ÿéš›ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
  child: ListTile(...),
)
```

### 2. å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°

```dart
Future<bool?> _confirmDismiss(
  BuildContext context,
  DismissDirection direction,
  ExpenseItem item,
) async {
  return showDialog<bool>(
    context: context,
    builder: (BuildContext dialogContext) {
      return AlertDialog(
        title: const Text('æ˜ç´°ã‚’å‰Šé™¤'),
        content: Column(
          mainAxisSize: MainAxisSize.min,
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            const Text('ã“ã®æ˜ç´°ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ'),
            const SizedBox(height: 16),
            // å‰Šé™¤å¯¾è±¡ã®æ˜ç´°æƒ…å ±ã‚’è¡¨ç¤º
            Container(
              padding: const EdgeInsets.all(12),
              decoration: BoxDecoration(
                color: Colors.grey[100],
                borderRadius: BorderRadius.circular(8),
              ),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  Text(item.payee, style: TextStyle(fontWeight: FontWeight.bold)),
                  Text(item.purpose),
                  Text(FormattingUtils.formatCurrency(item.amount)),
                ],
              ),
            ),
          ],
        ),
        actions: [
          TextButton(
            onPressed: () => Navigator.of(dialogContext).pop(false),
            child: const Text('ã‚­ãƒ£ãƒ³ã‚»ãƒ«'),
          ),
          FilledButton(
            onPressed: () => Navigator.of(dialogContext).pop(true),
            style: FilledButton.styleFrom(backgroundColor: Colors.red),
            child: const Text('å‰Šé™¤'),
          ),
        ],
      );
    },
  );
}
```

### 3. å‰Šé™¤å‡¦ç†ã®å®Ÿè¡Œ

```dart
Future<void> _onDismissed(
  DismissDirection direction,
  ExpenseItem item,
) async {
  final sheet = ref.read(expenseSheetProvider(widget.sheetId)).value;
  if (sheet != null) {
    // æ˜ç´°ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤
    final newItems = List<ExpenseItem>.from(sheet.items)
      ..removeWhere((e) => e.id == item.id);
    
    // æ›´æ–°ã•ã‚ŒãŸç²¾ç®—æ›¸ã‚’ä¿å­˜
    final newSheet = sheet.copyWith(items: newItems);
    await _updateSheet(newSheet);

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    if (mounted) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(
          content: Text('${item.payee}ã‚’å‰Šé™¤ã—ã¾ã—ãŸ'),
          duration: const Duration(seconds: 3),
          action: SnackBarAction(
            label: 'å…ƒã«æˆ»ã™',
            onPressed: () {
              // TODO: å‰Šé™¤ã®å–ã‚Šæ¶ˆã—æ©Ÿèƒ½ï¼ˆv1.2ã§å®Ÿè£…äºˆå®šï¼‰
            },
          ),
        ),
      );
    }
  }
}
```

## ğŸ¨ UIãƒ‡ã‚¶ã‚¤ãƒ³ã®ç‰¹å¾´

### ã‚¹ãƒ¯ã‚¤ãƒ—èƒŒæ™¯ã®ãƒ‡ã‚¶ã‚¤ãƒ³

- **è‰²**: `Colors.red` - å‰Šé™¤ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ˜ç¢ºã«ç¤ºã™
- **é…ç½®**: å³å¯„ã›ï¼ˆ`Alignment.centerRight`ï¼‰
- **ã‚¢ã‚¤ã‚³ãƒ³**: `Icons.delete_outline` - Material Designã‚¢ã‚¤ã‚³ãƒ³
- **ãƒ†ã‚­ã‚¹ãƒˆ**: "å‰Šé™¤" - æ—¥æœ¬èªã§æ˜ç¢ºã«è¡¨ç¤º
- **ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**: ã‚¹ãƒ¯ã‚¤ãƒ—ã«é€£å‹•ã—ã¦ã‚¹ãƒ ãƒ¼ã‚ºã«è¡¨ç¤º

### ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®ãƒ‡ã‚¶ã‚¤ãƒ³

- **ã‚¿ã‚¤ãƒˆãƒ«**: "æ˜ç´°ã‚’å‰Šé™¤" - ç°¡æ½”ã§æ˜ç¢º
- **å†…å®¹è¡¨ç¤º**: å‰Šé™¤å¯¾è±¡ã®æ˜ç´°æƒ…å ±ã‚’ã‚«ãƒ¼ãƒ‰å½¢å¼ã§è¡¨ç¤º
  - æ”¯æ‰•ã„å…ˆï¼ˆå¤ªå­—ï¼‰
  - ç›®çš„ãƒ»ç”¨é€”
  - é‡‘é¡ï¼ˆèµ¤è‰²ã§å¼·èª¿ï¼‰
- **ãƒœã‚¿ãƒ³é…ç½®**: 
  - å·¦: "ã‚­ãƒ£ãƒ³ã‚»ãƒ«" (TextButton)
  - å³: "å‰Šé™¤" (èµ¤è‰²ã®FilledButton)

### ListTileã®æ”¹å–„ãƒ‡ã‚¶ã‚¤ãƒ³

```dart
ListTile(
  contentPadding: const EdgeInsets.symmetric(horizontal: 16, vertical: 8),
  
  // æ—¥ä»˜è¡¨ç¤ºã‚’è¦–è¦šçš„ã«å¼·åŒ–
  leading: Container(
    width: 56,
    height: 56,
    decoration: BoxDecoration(
      color: Theme.of(context).colorScheme.primaryContainer,
      borderRadius: BorderRadius.circular(8),
    ),
    child: Column(
      mainAxisAlignment: MainAxisAlignment.center,
      children: [
        Text('${item.date.month}', style: TextStyle(fontSize: 12)),
        Text('${item.date.day}', style: TextStyle(fontSize: 20, fontWeight: FontWeight.bold)),
      ],
    ),
  ),
  
  // ã‚¿ã‚¤ãƒˆãƒ«ãƒ»ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ã®éšå±¤æ§‹é€ 
  title: Text(item.payee, style: TextStyle(fontWeight: FontWeight.w600, fontSize: 16)),
  subtitle: Column(
    crossAxisAlignment: CrossAxisAlignment.start,
    children: [
      Text(item.purpose),
      Row(
        children: [
          Icon(Icons.payment, size: 14),
          Text(item.paymentMethod),
        ],
      ),
    ],
  ),
  
  // é‡‘é¡ã‚’å³å¯„ã›ã§å¼·èª¿
  trailing: Text(
    FormattingUtils.formatCurrency(item.amount),
    style: TextStyle(fontWeight: FontWeight.bold, fontSize: 16),
  ),
)
```

## âš™ï¸ è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

### Dismissibleã®ä¸»è¦ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

| ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ | å€¤ | èª¬æ˜ |
|-----------|---|------|
| `direction` | `DismissDirection.endToStart` | å³ã‹ã‚‰å·¦ã¸ã®ã‚¹ãƒ¯ã‚¤ãƒ—ã®ã¿è¨±å¯ |
| `confirmDismiss` | asyncé–¢æ•° | å‰Šé™¤å‰ã®ç¢ºèªå‡¦ç† |
| `onDismissed` | asyncé–¢æ•° | ç¢ºèªå¾Œã®å‰Šé™¤å®Ÿè¡Œ |
| `background` | `Container` | ã‚¹ãƒ¯ã‚¤ãƒ—æ™‚ã®èƒŒæ™¯UI |
| `key` | `Key(item.id)` | å„ã‚¢ã‚¤ãƒ†ãƒ ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ |

### ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãªéƒ¨åˆ†

```dart
// ã‚¹ãƒ¯ã‚¤ãƒ—æ–¹å‘ã‚’å¤‰æ›´ã™ã‚‹å ´åˆ
direction: DismissDirection.horizontal, // å·¦å³ä¸¡æ–¹å‘

// ã‚¹ãƒ¯ã‚¤ãƒ—ã®é–¾å€¤ã‚’èª¿æ•´
dismissThresholds: {
  DismissDirection.endToStart: 0.7, // 70%ã‚¹ãƒ¯ã‚¤ãƒ—ã§å‰Šé™¤
},

// ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é€Ÿåº¦ã®èª¿æ•´
movementDuration: Duration(milliseconds: 200), // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
resizeDuration: Duration(milliseconds: 300),  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
```

## ğŸš€ ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

### v1.2ã§å®Ÿè£…äºˆå®š

1. **å…ƒã«æˆ»ã™æ©Ÿèƒ½**
   ```dart
   // å‰Šé™¤ã•ã‚ŒãŸæ˜ç´°ã‚’ä¸€æ™‚çš„ã«ã‚¹ã‚¿ãƒƒã‚¯ã«ä¿å­˜
   final List<ExpenseItem> _deletedItems = [];
   
   void _undoDelete() {
     if (_deletedItems.isNotEmpty) {
       final item = _deletedItems.removeLast();
       // ã‚¢ã‚¤ãƒ†ãƒ ã‚’å¾©å…ƒ
     }
   }
   ```

2. **ãƒãƒƒãƒå‰Šé™¤**
   - è¤‡æ•°é¸æŠãƒ¢ãƒ¼ãƒ‰
   - ä¸€æ‹¬å‰Šé™¤æ©Ÿèƒ½

3. **ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º**
   - å·¦ã‚¹ãƒ¯ã‚¤ãƒ—: å‰Šé™¤
   - å³ã‚¹ãƒ¯ã‚¤ãƒ—: ç·¨é›† or ãŠæ°—ã«å…¥ã‚Š

### v1.3ã§å®Ÿè£…äºˆå®š

1. **ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®å¼·åŒ–**
   - ãƒã‚¦ãƒ³ã‚¹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
   - å‰Šé™¤æ™‚ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ

2. **ãƒãƒ—ãƒ†ã‚£ãƒƒã‚¯ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**
   ```dart
   import 'package:flutter/services.dart';
   
   HapticFeedback.mediumImpact(); // ã‚¹ãƒ¯ã‚¤ãƒ—é–‹å§‹æ™‚
   HapticFeedback.heavyImpact();  // å‰Šé™¤ç¢ºå®šæ™‚
   ```

## ğŸ“ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ã®ä½¿ç”¨

```dart
// âŒ æ‚ªã„ä¾‹: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ã‚­ãƒ¼ã«ã™ã‚‹
key: Key('$index')

// âœ… è‰¯ã„ä¾‹: ã‚¢ã‚¤ãƒ†ãƒ ã®IDã‚’ã‚­ãƒ¼ã«ã™ã‚‹
key: Key(item.id)
```

**ç†ç”±**: ãƒªã‚¹ãƒˆã®é †åºãŒå¤‰ã‚ã£ã¦ã‚‚ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ­£ã—ãè¿½è·¡ã§ãã‚‹

### 2. éåŒæœŸå‡¦ç†ã®é©åˆ‡ãªå‡¦ç†

```dart
// âŒ æ‚ªã„ä¾‹: awaitãªã—ã§å‰Šé™¤
onDismissed: (direction) {
  _updateSheet(newSheet); // awaitãªã—
}

// âœ… è‰¯ã„ä¾‹: é©åˆ‡ã«awaitã™ã‚‹
onDismissed: (direction) async {
  await _updateSheet(newSheet);
  // å‰Šé™¤å®Œäº†å¾Œã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
}
```

### 3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```dart
Future<void> _onDismissed(...) async {
  try {
    await _updateSheet(newSheet);
    _showSuccessSnackBar();
  } catch (e) {
    _showErrorSnackBar(e);
    // å¿…è¦ã«å¿œã˜ã¦ã‚¢ã‚¤ãƒ†ãƒ ã‚’å¾©å…ƒ
  }
}
```

### 4. mounted ãƒã‚§ãƒƒã‚¯

```dart
if (mounted) {
  ScaffoldMessenger.of(context).showSnackBar(...);
}
```

**ç†ç”±**: éåŒæœŸå‡¦ç†ä¸­ã«ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒç ´æ£„ã•ã‚ŒãŸå ´åˆã®ã‚¨ãƒ©ãƒ¼ã‚’é˜²ã

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ1: ã‚¹ãƒ¯ã‚¤ãƒ—ã—ã¦ã‚‚åå¿œã—ãªã„

**åŸå› **: ã‚­ãƒ¼ãŒé‡è¤‡ã—ã¦ã„ã‚‹ã€ã¾ãŸã¯ä¸é©åˆ‡

**è§£æ±ºæ–¹æ³•**:
```dart
// å„ã‚¢ã‚¤ãƒ†ãƒ ã«ä¸€æ„ã®ã‚­ãƒ¼ã‚’è¨­å®š
key: Key(item.id),  // UUIDãªã©ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ID
```

### å•é¡Œ2: å‰Šé™¤å¾Œã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ

**åŸå› **: ãƒªã‚¹ãƒˆã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒç¯„å›²å¤–

**è§£æ±ºæ–¹æ³•**:
```dart
// removeAtã§ã¯ãªãremoveWhereã‚’ä½¿ç”¨
final newItems = List<ExpenseItem>.from(sheet.items)
  ..removeWhere((e) => e.id == item.id);
```

### å•é¡Œ3: ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œãªã„

**åŸå› **: `confirmDismiss`ãŒ`null`ã‚’è¿”ã—ã¦ã„ã‚‹

**è§£æ±ºæ–¹æ³•**:
```dart
confirmDismiss: (direction) async {
  final result = await _confirmDismiss(context, direction, item);
  return result ?? false; // nullã®å ´åˆã¯false
}
```

### å•é¡Œ4: å‰Šé™¤ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚«ã‚¯ã¤ã

**è§£æ±ºæ–¹æ³•**:
```dart
// ListView.builderã«cacheExtentã‚’è¿½åŠ 
ListView.builder(
  cacheExtent: 500, // ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ç¯„å›²
  itemBuilder: ...
)
```

## ğŸ“š å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

- [Flutter Dismissible Widget å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://api.flutter.dev/flutter/widgets/Dismissible-class.html)
- [Material Design - Swipe to dismiss](https://material.io/components/lists#behavior)
- [Flutter Cookbook - Dismiss items](https://docs.flutter.dev/cookbook/gestures/dismissible)

---

**æœ€çµ‚æ›´æ–°**: 2024å¹´12æœˆ - v1.1.0